---
- name: Test
  hosts: geoswitch_oxxo_qa
  tasks:
    - name: Check connectivity
      ping:

- name: Deploy Vault Agent
  hosts: geoswitch_oxxo_qa
  become: yes
  tasks:
  gather_facts: true
  roles:
    - geocom.geoscm.vault_agent_docker
  vars:
    vault_addr: "https://vault.geocom.com.uy"
    vault_agent_dir: "/home/geocom/vault-agent-docker"
    vault_agent_image: nexus.geocom.com.uy/hashicorp/vault-enterprise
    auth_method: "approle"
    app_name: "geoswitch-yza"
    tcp_listener_address: "0.0.0.0:8200"
    policies: 
      - geoswitch-policy-qa
    token_type: "service"
    secret_id_ttl: "24h"
    token_num_uses: 0
    token_ttl: "1h"
    token_max_ttl: "24h"
    secret_id_num_uses: 0
    vault_agent_user: vault-agent
    vault_agent_group: vault-agent