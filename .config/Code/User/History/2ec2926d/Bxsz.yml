---
- name: Leer contenido del archivo YAML
  ansible.builtin.slurp:
    src: "{{ file.path }}"
  register: file_content

- name: File content
  debug:
    msg: "File content is: {{ file.path }}"

- name: Convertir contenido a YAML
  set_fact:
    connector_config_yml: "{{ file_content['content'] | b64decode | from_yaml }}"

- name: Transformar configuración de YAML a JSON para la API
  set_fact:
    connector_config: "{{ connector_config_yml.connector | to_nice_json }}"

- name: Connector config output
  debug:
    msg: "Connector config is: {{ connector_config }}"

- name: Publicar configuración del connector a Kafka Connect
  uri:
    url: "{{ kafka_connect_api_url }}"
    method: POST
    body: "{{ connector_config }}"
    body_format: json
    status_code: [201, 200]
    return_content: yes
  register: response
  ignore_errors: true

- name: Respuesta de la API
  debug:
    var: response.json